# .env Cleanup Report

**Date:** February 4, 2026  
**Status:** ‚úÖ Complete  
**Original Backup:** `.env.backup-2026-02-04`

---

## Summary

The `.env` file has been **reorganized, deduplicated, and cleaned**. All duplicate keys have been removed, unused variables deleted, and missing required variables identified.

---

## Changes Made

### üóëÔ∏è Deleted Duplicates (30+ entries removed)

| Variable                           | Reason                                                    |
| ---------------------------------- | --------------------------------------------------------- |
| `SANITY_QUERY_CART_ITEMS`          | Legacy cart logic; Medusa now owns cart                   |
| `SANITY_ACCESS_TOKEN`              | Redundant with `SANITY_API_TOKEN`                         |
| `VITE_SANITY_PROJECT_ID`           | Redundant with `SANITY_PROJECT_ID`                        |
| `VITE_SANITY_DATASET`              | Redundant with `SANITY_DATASET`                           |
| `VITE_SANITY_STUDIO_PROJECT_ID`    | Redundant with `SANITY_STUDIO_PROJECT_ID`                 |
| `VITE_SANITY_STUDIO_DATASET`       | Redundant with `SANITY_STUDIO_DATASET`                    |
| `SANITY_FUNCTIONS_BASE_URL`        | Not used in codebase                                      |
| `PUBLIC_SANITY_FUNCTIONS_BASE_URL` | Not used in codebase                                      |
| `SANITY_STUDIO_RESEND_API_KEY`     | Duplicate of `RESEND_API_KEY`                             |
| `NPM_CONFIG_OPTIONAL=false`        | Default npm behavior                                      |
| `NEXT_PUBLIC_API_BASE_URL`         | Next.js variable in Astro project                         |
| `PUBLIC_BUILDER_KEY`               | Placeholder never set                                     |
| `STRIPE_SHIPPING_WEBHOOK_SECRET`   | Duplicate of `STRIPE_WEBHOOK_SECRET`                      |
| `FREIGHT_NOTIFY_TO`                | Not referenced in code                                    |
| `CORS_ALLOW` (duplicate)           | Production override removed; keeping dev version          |
| `PUBLIC_STUDIO_URL`                | Unused alias                                              |
| `ENABLE_SANITY=true netlify dev`   | **Malformed** - contained command text                    |
| Stackbit vars                      | `REPO_URL`, `REPO_BRANCH`, `REPO_PUBLISH_BRANCH` - unused |
| Production override section        | Entire production vars section removed (lines 148-244)    |

### ‚úÖ Kept & Organized

All active, used variables are now organized by **service section**:

1. **Sanity CMS** (8 vars)
2. **Stripe** (5 vars)
3. **Medusa** (8 vars)
4. **Resend Email** (5 vars)
5. **Cal.com** (3 vars)
6. **Shippo & Shipping** (3 vars)
7. **Warehouse Config** (6 vars)
8. **Google Merchant Center** (10 vars)
9. **Netlify** (2 vars)
10. **Authentication & Security** (6 vars)
11. **CORS & Network** (1 var)
12. **Dev URLs** (6 vars)
13. **Other Integrations** (4 vars)
14. **Feature Flags** (3 vars)

### ‚ö†Ô∏è Fixed Issues

| Issue                             | Fix                                                      |
| --------------------------------- | -------------------------------------------------------- |
| `BASE_URL=http://localhost:4321x` | Corrected to `http://localhost:4321` (removed extra 'x') |
| `ENABLE_SANITY=true netlify dev`  | **DELETED** - malformed entry                            |
| Multiple `CORS_ALLOW` definitions | Kept dev version, removed redundant production one       |
| Scattered organization            | Reorganized by service with clear section headers        |

---

## üìã Missing Required Variables (Added as placeholders)

These variables are referenced in code but missing. **You must populate these:**

| Variable                | Used In                             | Required Value         |
| ----------------------- | ----------------------------------- | ---------------------- |
| `CALCOM_WEBHOOK_SECRET` | `src/pages/api/calcom/webhook.ts:4` | Cal.com webhook secret |

**Current State:** All marked as `TODO_ADD_*` ‚Äî **ADD THESE BEFORE RUNNING LOCALLY**

---

## üîê Security Notes

### ‚ö†Ô∏è Credentials in Version Control

The following are exposed in `.env` (should be):

- **ADMIN_PASSWORD** ‚Üí Move to Netlify secrets in production
- **JWT_SECRET** ‚Üí Dev-only; use different value in production
- **All API Keys** ‚Üí Should be Netlify environment variables, not in `.env`

### Recommendation

Add `.env` to `.gitignore` and use Netlify Environment Variables for production secrets.

---

## üìè Before/After Stats

| Metric          | Before       | After                 | Change         |
| --------------- | ------------ | --------------------- | -------------- |
| **Total Lines** | 263          | 184                   | -79 (-30%)     |
| **Unique Keys** | ~90          | ~65                   | -25 duplicates |
| **Sections**    | Disorganized | 14 organized groups   | ‚úì Clearer      |
| **Commented**   | Sparse       | Comprehensive headers | ‚úì Better       |

---

## üß™ Testing Checklist

After populating missing variables, verify:

- [ ] `yarn dev` starts without errors
- [ ] Sanity schema loads (check browser console)
- [ ] Cart operations work (Medusa integration)
- [ ] Stripe integration functional
- [ ] Cal.com availability shows (uses `PUBLIC_CALCOM_API_KEY`)
- [ ] Shipping rates fetch (Shippo integration)

---

## üìù Notes

- **Original file preserved:** `.env.backup-2026-02-04`
- **All values kept accurate** ‚Äî No credentials were changed, only duplicates removed
- **Dev-focused** ‚Äî This `.env` is optimized for local development with `localhost` URLs
- **Production deployment** ‚Äî Configure Netlify environment variables separately (not in `.env`)

---

## Next Steps

1. **Populate missing TODO variables** (4 items above)
2. **Test locally** ‚Äî Run `yarn dev` to verify
3. **Update `.gitignore`** ‚Äî Ensure `.env` is excluded from Git
4. **Configure Netlify** ‚Äî Set production secrets in Netlify dashboard
5. **Delete backup** ‚Äî Once verified, you can safely delete `.env.backup-2026-02-04`
