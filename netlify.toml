[[redirects]]
  from = "/site.webmanifest"
  to = "/site.webmanifest"
  status = 200

# Legacy domain + WooCommerce URL redirects consolidated from public/_redirects
[[redirects]]
  from = "https://fasmotorsports.us/*"
  to = "https://www.fasmotorsports.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "https://www.fasmotorsports.us/*"
  to = "https://www.fasmotorsports.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "/product/2-4l-2-7l-snout-porting"
  to = "/shop/2-4l-hellcat-billet-supercharger-snout"
  status = 301
  force = true

[[redirects]]
  from = "/product/2-4l-2-7l-snout-porting/"
  to = "/shop/2-4l-hellcat-billet-supercharger-snout"
  status = 301
  force = true

[[redirects]]
  from = "/product/180-hellcat-thermostat"
  to = "/shop/180-hellcat-thermostat"
  status = 301
  force = true

[[redirects]]
  from = "/product/180-hellcat-thermostat/"
  to = "/shop/180-hellcat-thermostat"
  status = 301
  force = true

[[redirects]]
  from = "/product/2018-23-mustang-gt-ported-intake-manifold"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/2018-23-mustang-gt-ported-intake-manifold/"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/2018-23-mustang-gt-ported-intake-manifolds"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/2018-23-mustang-gt-ported-intake-manifolds/"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/boss-intake-manifold-porting"
  to = "/shop/boss-intake-manifold-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/boss-intake-manifold-porting/"
  to = "/shop/boss-intake-manifold-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/dodge-demon-charger-ported-intake-manifold"
  to = "/shop/hemi-intake-manifold-porting-6-4l-6-1l-5-7l"
  status = 301
  force = true

[[redirects]]
  from = "/product/dodge-demon-charger-ported-intake-manifold/"
  to = "/shop/hemi-intake-manifold-porting-6-4l-6-1l-5-7l"
  status = 301
  force = true

[[redirects]]
  from = "/product/dodge-demon-charger-ported-intake-manifolds"
  to = "/shop/hemi-intake-manifold-porting-6-4l-6-1l-5-7l"
  status = 301
  force = true

[[redirects]]
  from = "/product/dodge-demon-charger-ported-intake-manifolds/"
  to = "/shop/hemi-intake-manifold-porting-6-4l-6-1l-5-7l"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-hub-kit"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-hub-kit/"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-hub-kit-with-billet-bolt"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-hub-kit-with-billet-bolt/"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-hub-kit-upgraded-pulley-ring"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-hub-kit-upgraded-pulley-ring/"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-race-ported-throttle-body"
  to = "/shop/hellcat-throttle-body-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-race-ported-throttle-body/"
  to = "/shop/hellcat-throttle-body-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-street-ported-throttle-body"
  to = "/shop/hellcat-throttle-body-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-street-ported-throttle-body/"
  to = "/shop/hellcat-throttle-body-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-upper-pulley-ring-only"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-upper-pulley-ring-only/"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-pulley-ring-only"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-pulley-ring-only/"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-supercharger-ported-intake-manifold-service"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-supercharger-ported-intake-manifold-service/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-supercharger-ported-intake-manifold-services"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-supercharger-ported-intake-manifold-services/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-supercharger-ported-intake-manifolds"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-upper-supercharger-ported-intake-manifolds/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-ported-intake-manifold-service"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-ported-intake-manifold-service/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-ported-intake-manifold-services"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-ported-intake-manifold-services/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-ported-intake-manifolds"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/hellcat-supercharger-ported-intake-manifolds/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-ported-intake-manifold"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-ported-intake-manifold/"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-ported-intake-manifolds"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-ported-intake-manifolds/"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-ported-intake-manifold-service"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-ported-intake-manifold-service/"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-ported-intake-manifold-services"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-ported-intake-manifold-services/"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-ported-intake-manifolds"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-ported-intake-manifolds/"
  to = "/shop/lsa-ls9-lt4-supercharger-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-snout-porting"
  to = "/shop/lt4-supercharger-snout-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-snout-porting/"
  to = "/shop/lt4-supercharger-snout-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-snout-porting-6-4l-6-2l"
  to = "/shop/lt4-supercharger-snout-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-snout-porting-6-4l-6-2l/"
  to = "/shop/lt4-supercharger-snout-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-snout-porting-service-package"
  to = "/shop/lt4-supercharger-snout-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/lt4-supercharger-snout-porting-service-package/"
  to = "/shop/lt4-supercharger-snout-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/mustang-gt-ported-intake-manifold"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/mustang-gt-ported-intake-manifold/"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/mustang-gt-ported-intake-manifolds"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/mustang-gt-ported-intake-manifolds/"
  to = "/shop/mustang-gt-ported-intake-manifold"
  status = 301
  force = true

[[redirects]]
  from = "/product/mustang-gt-intake-manifold-porting"
  to = "/shop/mustang-gt-intake-manifold-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/mustang-gt-intake-manifold-porting/"
  to = "/shop/mustang-gt-intake-manifold-porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/predator-5-2-supercharged-intake-manifold-porting"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/predator-5-2-supercharged-intake-manifold-porting/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-billet-supercharger-hub-kit"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-billet-supercharger-hub-kit/"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-ported-intake-manifold-service"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-ported-intake-manifold-service/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-ported-intake-manifold-services"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-ported-intake-manifold-services/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-upper-pulley-ring-only"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-upper-pulley-ring-only/"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-upgraded-pulley-ring"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-upgraded-pulley-ring/"
  to = "/shop/upper-pulley-ring-only"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-upgraded-pulley-ring-with-bolt"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-supercharger-upgraded-pulley-ring-with-bolt/"
  to = "/shop/pulley-and-hub-kit"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-upper-supercharger-ported-intake-manifold-service"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-upper-supercharger-ported-intake-manifold-service/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-upper-supercharger-ported-intake-manifold-services"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-upper-supercharger-ported-intake-manifold-services/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-upper-supercharger-ported-intake-manifolds"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/srt-hellcat-upper-supercharger-ported-intake-manifolds/"
  to = "/services/porting"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-ported-intake-manifold-service"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-ported-intake-manifold-service/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-ported-intake-manifold-services"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-ported-intake-manifold-services/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-ported-intake-manifolds"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-ported-intake-manifolds/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-supercharger-ported-intake-manifold-service"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-supercharger-ported-intake-manifold-service/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-supercharger-ported-intake-manifold-services"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-supercharger-ported-intake-manifold-services/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-supercharger-ported-intake-manifolds"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-3-0-supercharger-ported-intake-manifolds/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-ported-supercharger-intake-manifold-service"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-ported-supercharger-intake-manifold-service/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-ported-supercharger-intake-manifold-services"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/whipple-ported-supercharger-intake-manifold-services/"
  to = "/shop/3-0l-whipple-porting-service-hellcat"
  status = 301
  force = true

[[redirects]]
  from = "/product/:slug"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/product/:slug/"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/products/:slug"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/products/:slug/"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/product-category/:category"
  to = "/shop?categorySlug=:category"
  status = 301
  force = true

[[redirects]]
  from = "/product-category/:category/"
  to = "/shop?categorySlug=:category"
  status = 301
  force = true

[[redirects]]
  from = "/product-category/:category/:slug"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/product-category/:category/:slug/"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/product-category/:category/:subcategory/:slug"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/product-category/:category/:subcategory/:slug/"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/shop/product/:slug"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/shop/product/:slug/"
  to = "/shop/:slug"
  status = 301
  force = true

[[redirects]]
  from = "/warranty/"
  to = "/warranty"
  status = 301
  force = true

[[redirects]]
  from = "/shop/filters/platform/:platform/product_cat/:category/*"
  to = "/shop?platform=:platform&categorySlug=:category"
  status = 301
  force = true

[[redirects]]
  from = "/shop/filters/platform/:platform/*"
  to = "/shop?platform=:platform"
  status = 301
  force = true

[[redirects]]
  from = "/shop/filters/*"
  to = "/shop"
  status = 301
  force = true

[[redirects]]
  from = "/my-account/*"
  to = "/account"
  status = 301
  force = true

[[redirects]]
  from = "/checkout/success"
  to = "/checkout/success"
  status = 200

[[redirects]]
  from = "/checkout/cancel"
  to = "/checkout/cancel"
  status = 200

[[redirects]]
  from = "/checkout/*"
  to = "/cart"
  status = 301
  force = true

[[redirects]]
  from = "/cart/*"
  to = "/cart"
  status = 301
  force = true

# Astro already generates the correct serverless function routing for SSR builds.
# A blanket SPA-style catch-all would rewrite asset requests (e.g. CSS, JS, Astro
# component modules) to the HTML shell which then surfaces in the browser as
# "Failed to load module script" MIME-type errors. Removing the fallback keeps
# the platform-provided routing intact while still allowing the upstream
# redirect table above to function as intended.

## Note: Custom auth uses Astro API under /api/auth/*; no redirects needed.

[build]
  command = "yarn install && yarn build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "18"
  GO_VERSION = "1.20"
  PHP_VERSION = "8.3"
  NETLIFY_USE_YARN = "true"
  NETLIFY_EXPERIMENTAL_YARN_BERRY = "false"
  YARN_VERSION = "1.22.19"
  # Used by /api/checkout to build absolute success/cancel URLs
  # In production on Netlify, forwarded host headers are present, so this is a safe default.
  PUBLIC_BASE_URL = "https://fasmotorsports.com"
  # Canonical site URL used as a fallback by auth flows
  PUBLIC_SITE_URL = "https://www.fasmotorsports.com"

[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"

# Help Netlify Dev choose the right framework command
[dev]
  framework = "astro"
  command = "astro dev --host 0.0.0.0 --port 3000"
  targetPort = 3000
  port = 8888
  autoLaunch = false

# Build plugins
[[plugins]]
  package = "netlify-plugin-cache"
  [plugins.inputs]
    paths = [
      "node_modules/.cache",
      ".astro",
      ".cache",
      "package-lock.json"
    ]

[[plugins]]
  package = "netlify-plugin-inline-critical-css"
  [plugins.inputs]
    extract = true

#[[plugins]]
#  package = "netlify-plugin-minify-html"

[[plugins]]
  package = "netlify-plugin-submit-sitemap"
  [plugins.inputs]
    baseUrl = "https://www.fasmotorsports.com"
    sitemapPath = "/sitemap_index.xml"


# (moved to deploy-preview context to save prod build time)


# Run a11y checks only on Deploy Previews to avoid slowing/failing production builds
[context.deploy-preview]
  # Run Lighthouse only on Deploy Previews
  [[plugins]]
    package = "@netlify/plugin-lighthouse"

  # Run link checking only on Deploy Previews to avoid flakiness/crashes
  [[plugins]]
    package = "netlify-plugin-checklinks"

## Removed netlify-plugin-csp (not on npm) in favor of static CSP header below

# Caching headers
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/_astro/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*"
  [headers.values]
    Cache-Control = "public, max-age=300"
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: https://www.googletagmanager.com https://apis.google.com https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/ https://js.stripe.com https://app.netlify.com https://ve.netlify.app https://*.netlify.app; connect-src 'self' https://*.sanity.io https://api.stripe.com https://*.shipengine.com https://app.netlify.com https://ve.netlify.app https://*.netlify.app wss://*.netlify.app wss://ve.netlify.app; img-src 'self' data: blob: https:; style-src 'self' 'unsafe-inline'; font-src 'self' data: https:; media-src 'self' https: http: blob: data:; frame-src https://www.google.com https://www.google.com/recaptcha/ https://js.stripe.com https://app.netlify.com https://*.netlify.app https://www.youtube.com https://youtube.com; frame-ancestors 'self' https://app.netlify.com https://*.netlify.app"
# Avoid caching the account page so auth callback always runs with fresh HTML
[[headers]]
  for = "/account"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate"

[[headers]]
  for = "/account/*"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate"
