---
import BaseLayout from '../layouts/BaseLayout.astro';

const baseURL = import.meta.env.PUBLIC_API_URL || 'https://fasmotorsports.com';

const customerRes = await fetch(`${baseURL}/api/get-customer-profile`);
const ordersRes = await fetch(`${baseURL}/api/get-user-orders`);
const quotesRes = await fetch(`${baseURL}/api/get-user-quotes`);

const customerProfile = customerRes.ok ? await customerRes.json() : null;
const userOrders = ordersRes.ok ? await ordersRes.json() : null;
const userQuotes = quotesRes.ok ? await quotesRes.json() : null;
---
<style>
  .gauge-spinner {
    margin: 20px auto;
    width: 50px;
    height: 50px;
    border: 6px solid lightgray;
    border-top: 6px solid #dc2626; /* red like a revving RPM */
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>

<BaseLayout>
  <main class="px-6 py-8 text-white font-captain">
    <h1 class="text-4xl font-cyber mb-6">My Garage</h1>

    <section>
      <h2 class="text-2xl font-borg mb-4">Service Orders</h2>
      {userOrders === null ? (
        <div class="gauge-spinner"></div>
      ) : userOrders.length > 0 ? (
        <ul>
          {userOrders.map(order => (
            <li>{order.title} - {order.status}</li>
          ))}
        </ul>
      ) : (
        <p>No service orders yet — time to hit the track!</p>
      )}
    </section>

    <section>
      <h2 class="text-2xl font-borg mb-4">Custom Build Quotes</h2>
      {userQuotes === null ? (
        <div class="gauge-spinner"></div>
      ) : userQuotes.length > 0 ? (
        <ul>
          {userQuotes.map(quote => (
            <li>{quote.title} - {quote.status}</li>
          ))}
        </ul>
      ) : (
        <p>No custom quotes yet — let's start building your dream ride!</p>
      )}
    </section>

    <section>
      <h2 class="text-2xl font-borg mb-4">Driver Profile</h2>
      {customerProfile === null ? (
        <div class="gauge-spinner"></div>
      ) : (
        <>
          <p class="mb-2">Name: {customerProfile.customer.name}</p>
          <p class="mb-2">Phone: {customerProfile.customer.phone}</p>
        </>
      )}
    </section>
  </main>
</BaseLayout>