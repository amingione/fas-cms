---
/**
 * Stripe Embedded Checkout Page
 *
 * This page embeds the Stripe Checkout directly on your site.
 * Benefits:
 * - Customer never leaves your site
 * - Real-time shipping rate updates via EasyPost
 * - Better UX with no redirects
 * - Full styling control
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import EmbeddedCheckout from '@/components/checkout/EmbeddedCheckout';

// Get cart from session/localStorage on server side if needed
const pageTitle = 'Checkout | FAS Motorsports';
const pageDescription = 'Complete your purchase';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <main class="checkout-page">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
      <h1 class="text-3xl font-bold mb-6">Checkout</h1>

      <!-- Embedded Checkout Component -->
      <div id="checkout-container" class="bg-white rounded-lg shadow-lg p-6">
        <EmbeddedCheckout client:load />
      </div>

      <!-- Loading State -->
      <div id="checkout-loading" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
        <p class="mt-4 text-gray-600">Loading checkout...</p>
      </div>

      <!-- Error State -->
      <div id="checkout-error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6">
        <h2 class="text-xl font-semibold text-red-800 mb-2">Checkout Error</h2>
        <p class="text-red-700 mb-4">We encountered an error loading the checkout form.</p>
        <a href="/cart" class="inline-block bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">
          Return to Cart
        </a>
      </div>
    </div>
  </main>
</BaseLayout>

<style>
  .checkout-page {
    min-height: calc(100vh - 200px);
    background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
  }

  #checkout-container {
    min-height: 600px;
  }

  /* Stripe Embedded Checkout will inject content here */
  #checkout-container iframe {
    width: 100%;
    min-height: 600px;
  }
</style>
