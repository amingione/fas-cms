---
/**
 * Checkout Page with Feature Flag Support
 *
 * This version supports toggling between legacy and new checkout UI.
 * Use this to replace index.astro when implementing the new checkout.
 *
 * ROLLBACK: If issues occur, simply set PUBLIC_USE_NEW_CHECKOUT=false
 * in your .env file and redeploy.
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import { getFeatureFlag } from '@/config/feature-flags';

// Import both versions
import CheckoutFlow from '@/components/checkout/CheckoutFlow';
import CheckoutFlowNew from '@/components/checkout/CheckoutFlowNew';

const pageTitle = 'Checkout | FAS Motorsports';
const pageDescription = 'Complete your purchase';

// Feature flag: use new checkout UI or legacy
const useNewCheckout = getFeatureFlag('useNewCheckoutUI');

	// NOTE: Avoid rendering a variable component with hydration directives.
	// Astro needs a statically-imported component reference to generate the
	// correct client hydration import map.
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <main class="checkout-page">
    {useNewCheckout ? (
      <!-- New Split-Screen Layout -->
      <div class="checkout-new-layout">
        <CheckoutFlowNew client:load />
      </div>
    ) : (
      <!-- Legacy Layout -->
      <div class="container mx-auto px-4 py-8 max-w-7xl">
        <h1 class="text-3xl font-bold mb-6 text-white">Checkout</h1>
        <div id="checkout-container" class="bg-white rounded-lg shadow-lg p-6">
          <CheckoutFlow client:load />
        </div>
      </div>
    )}

  </main>
</BaseLayout>

<style>
  .checkout-page {
    min-height: calc(100vh - 200px);
    background: linear-gradient(to bottom, #0b0b0c 0%, #151515 100%);
  }

  /* Legacy container styling */
  #checkout-container {
    min-height: 400px;
  }

  /* New checkout layout styling will be added here */
  .checkout-new-layout {
    /* Split-screen layout styles */
  }
</style>
