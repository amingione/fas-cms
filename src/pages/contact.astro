---
import BaseLayout from '../layouts/BaseLayout.astro';

const url = new URL(Astro.request.url);
const isSuccess = url.searchParams.get('success') === 'true';
const isError = url.searchParams.get('error') === 'true';
---

<BaseLayout>
  <section class="min-h-screen bg-black text-white font-captain">
    <!-- Google Map Embed -->
    <div class="w-full h-[400px] grayscale contrast-125 saturate-0">
      <iframe
        src="https://www.google.com/maps?q=6161+Riverside+Dr,+Fort+Myers,+FL+33982&output=embed"
        width="100%"
        height="100%"
        style="border:0;"
        allowfullscreen
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
      ></iframe>
    </div>

    <!-- Contact Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 max-w-6xl mx-auto px-6 py-16">
      
      <!-- Contact Form -->
      <form id="contact-form" method="POST" action="/api/contact" class="space-y-6 bg-[#121212] p-8 rounded-lg border border-gray-700 shadow-lg relative">
        <h2 class="text-3xl font-cyber text-accent mb-4">Send a Message</h2>

        <!-- Success or Error Message -->
        {isSuccess && (
          <div class="absolute top-[-70px] left-0 w-full fade-in bg-green-800 border border-green-600 text-accent text-center py-3 rounded mb-4">
            Message sent successfully! We'll get back to you soon.
          </div>
        )}
        {isError && (
          <div class="absolute top-[-70px] left-0 w-full fade-in bg-red-800 border border-red-600 text-accent text-center py-3 rounded mb-4">
            Error sending message. Please try again.
          </div>
        )}

        <div>
          <label for="name" class="block text-sm text-graylight mb-1">Name</label>
          <input type="text" id="name" name="name" required class="w-full px-4 py-2 bg-black border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-primary text-white" />
        </div>

        <div>
          <label for="email" class="block text-sm text-graylight mb-1">Email</label>
          <input type="email" id="email" name="email" required class="w-full px-4 py-2 bg-black border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-primary text-white" />
        </div>

        <div>
          <label for="message" class="block text-sm text-graylight mb-1">Message</label>
          <textarea id="message" name="message" rows="4" required class="w-full px-4 py-2 bg-black border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-primary text-white"></textarea>
        </div>

        <button type="submit" class="bg-primary hover:bg-accent text-black font-bold py-2 px-6 rounded transition duration-200">
          Send
        </button>
      </form>

      <!-- Contact Info -->
      <div class="flex flex-col justify-start bg-[#121212] p-8 rounded-lg border border-gray-700 shadow-lg">
        <h2 class="text-3xl font-cyber text-accent mb-6">Contact Info</h2>
        <p class="mb-4 text-graylight"><strong class="text-primary">Phone:</strong> (812) 200-9012</p>
        <p class="mb-4 text-graylight">
          <strong class="text-primary">Email:</strong>
          <a href="mailto:support@fasmotorsports.com" class="text-accent hover:text-primary">support@fasmotorsports.com</a>
        </p>
        <p class="mb-4 text-graylight">
          <strong class="text-primary">Sales:</strong>
          <a href="mailto:sales@fasmotorsports.com" class="text-accent hover:text-primary">sales@fasmotorsports.com</a>
        </p>
        <p class="mb-4 text-graylight">
          <strong class="text-primary">Hours:</strong> Mon–Fri, 9am–5pm
        </p>
      </div>
    </div>
  </section>

  <!-- Auto-reset form script on success -->
  {isSuccess && (
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('contact-form');
        if (form instanceof HTMLFormElement) form.reset();
      });
    </script>
  )}
</BaseLayout>