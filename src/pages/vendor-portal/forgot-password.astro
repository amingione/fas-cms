---
import BaseLayout from '@/layouts/BaseLayout.astro';
const title = 'Vendor Portal - Forgot Password';
---

<BaseLayout title={title} noindex>
  <div class="min-h-screen flex items-center justify-center px-4 bg-black">
    <div class="w-full max-w-md rounded-lg border border-white/20 bg-zinc-900/80 p-6 shadow-xl text-white">
      <h1 class="text-3xl font-bold text-primary uppercase text-center mb-3">Reset password</h1>
      <p class="text-sm text-white/70 text-center mb-6">
        Enter the email linked to your vendor portal account. If it exists, we will email a reset link.
      </p>
      <form id="vp-forgot" class="space-y-4">
        <div>
          <label class="block text-sm font-semibold mb-2" for="vp-forgot-email">Email</label>
          <input
            id="vp-forgot-email"
            name="email"
            type="email"
            required
            class="w-full rounded-md border border-white/20 bg-black px-3 py-2 text-white focus:border-primary focus:outline-none"
          />
        </div>
        <button
          type="submit"
          class="w-full rounded-md bg-primary px-4 py-2 font-semibold uppercase tracking-wide text-white hover:bg-primary/80 transition"
        >
          Send reset link
        </button>
        <p id="vp-forgot-status" class="text-sm text-center hidden"></p>
      </form>
      <p class="text-center text-sm mt-4">
        <a href="/vendor-portal/login" class="text-primary hover:underline">Back to login</a>
      </p>
    </div>
  </div>

  <script>
    const form = document.querySelector('#vp-forgot');
    const statusEl = document.querySelector('#vp-forgot-status');

    form?.addEventListener('submit', async (event) => {
      event.preventDefault();
      const email = (document.querySelector('#vp-forgot-email') as HTMLInputElement | null)?.value.trim() || '';
      if (!statusEl) return;
      statusEl.classList.add('hidden');
      statusEl.classList.remove('text-green-400', 'text-red-400');

      try {
        const res = await fetch('/api/auth/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await res.json().catch(() => ({}));
        statusEl.textContent = data.message || 'If an account exists, we sent a reset link.';
        statusEl.classList.add(res.ok ? 'text-green-400' : 'text-red-400');
      } catch (err) {
        statusEl.textContent = 'Network error. Please try again.';
        statusEl.classList.add('text-red-400');
      } finally {
        statusEl.classList.remove('hidden');
      }
    });
  </script>
</BaseLayout>
