---
import BaseLayout from '@/layouts/BaseLayout.astro';
import VendorCard from '@/components/store/VendorCard.tsx';
import { sanityClient } from '@/lib/sanity';
import { activeVendorsQuery, featuredVendorsQuery } from '@/lib/queries';

export const prerender = false;

let vendors: any[] = [];
let featuredVendors: any[] = [];

try {
  [vendors, featuredVendors] = await Promise.all([
    sanityClient.fetch(activeVendorsQuery),
    sanityClient.fetch(featuredVendorsQuery)
  ]);
} catch (error) {
  console.error('Error fetching vendors:', error);
}

const pageTitle = 'Vendor Directory';
const pageDescription =
  'Browse trusted partners bringing premium performance parts and fabrication to the FAS storefront.';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <div class="relative overflow-hidden">
    <div
      class="pointer-events-none absolute inset-0 bg-gradient-to-b from-primary/10 via-transparent to-black"
    >
    </div>

    <section class="relative mx-auto max-w-6xl px-4 py-16 space-y-14">
      <header class="text-center space-y-4">
        <p class="text-sm font-semibold uppercase tracking-[0.2em] text-primary">Partners</p>
        <h1 class="text-4xl font-bold text-white md:text-5xl">Our Trusted Vendors</h1>
        <p class="mx-auto max-w-2xl text-base text-neutral-300 md:text-lg">
          We collaborate with leading manufacturers and fabricators to deliver proven performance
          gear. Explore featured partners and the full vendor roster.
        </p>
      </header>

      {
        featuredVendors?.length > 0 && (
          <section class="space-y-6">
            <div class="flex items-center justify-between gap-4">
              <h2 class="text-2xl font-semibold text-white">Featured Partners</h2>
              <span class="text-sm text-neutral-400">Handpicked standouts</span>
            </div>

            <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
              {featuredVendors.map((vendor) => (
                <VendorCard vendor={vendor} featured />
              ))}
            </div>
          </section>
        )
      }

      <section class="space-y-6">
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-2xl font-semibold text-white">All Vendors</h2>
          <span class="text-sm text-neutral-400">
            {vendors?.length || 0} partner{vendors?.length === 1 ? '' : 's'}
          </span>
        </div>

        {
          vendors?.length > 0 ? (
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
              {vendors.map((vendor) => (
                <VendorCard vendor={vendor} />
              ))}
            </div>
          ) : (
            <div class="rounded-2xl border border-white/10 bg-white/5 p-8 text-center text-neutral-300">
              No vendors to show yet. Check back soon as we onboard more partners.
            </div>
          )
        }
      </section>

      <section class="grid gap-6 md:grid-cols-[2fr_1fr]">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-8 shadow-card">
          <h3 class="text-2xl font-semibold text-white">Become a Vendor</h3>
          <p class="mt-3 text-neutral-300">
            Want to collaborate with FAS? We are always looking for high-quality manufacturers,
            tuners, and fabricators to join our lineup.
          </p>
          <a
            class="mt-6 inline-flex items-center justify-center rounded-full bg-primary px-5 py-3 text-sm font-semibold uppercase tracking-wide text-white transition hover:bg-primary/90"
            href="/contact?subject=vendor-inquiry"
          >
            Contact Us
          </a>
        </div>

        <div class="rounded-2xl border border-white/10 bg-[#1a1a1a] p-6 text-center">
          <p class="text-sm text-neutral-300">Already a vendor?</p>
          <a
            href="/vendor-portal/login"
            class="mt-3 inline-flex items-center justify-center rounded-full border border-white/20 px-5 py-3 text-sm font-semibold text-white transition hover:border-primary hover:text-primary"
          >
            Access Vendor Portal â†’
          </a>
        </div>
      </section>
    </section>
  </div>
</BaseLayout>
