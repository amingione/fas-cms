---
// Photo Grid Gallery (gallery_1)
// Props: images?: Array<{ src: string; alt?: string }>
const { images = [] } = Astro.props as { images?: Array<{ src: string; alt?: string }> };
const defaults = [
  { src: '/images/packages/ram-trx-factory-freak.webp', alt: 'RAM TRX Build' },
  { src: '/images/packages/850-ram.webp', alt: '850 HP RAM Build' },
  { src: '/images/packages/fas0f150-10002800.webp', alt: 'F‑150 800–1000+ Build' },
  { src: '/images/packages/F250-FAS.webp', alt: 'Ford F‑250 / F‑150' },
  { src: '/images/packages/Shelby-truck.webp', alt: 'Raptor / Shelby Build' },
  { src: '/images/packages/dodge-ram.webp', alt: 'Dodge RAM Build' },
];
const imgs = (images.length >= 6 ? images.slice(0, 6) : [...defaults, ...images].slice(0, 6));
---

<section class="gallery_1">
  <div class="responsive-container-block bigContainer">
    <div class="responsive-container-block Container">
      <div class="responsive-container-block imgContainer">
        <div class="project project1 border border-rounded rounded-lg drop-shadow shadow-md shadow-white/20 border-white/5" data-idx="0">
          <img class="smallImage bg-black" src={imgs[0]?.src} alt={imgs[0]?.alt || 'Truck build'} loading="lazy" />
        </div>
        <div class="project project2 border border-rounded rounded-lg drop-shadow shadow-md shadow-white/20 border-white/5" data-idx="1">
          <img class="smallImage" src={imgs[1]?.src} alt={imgs[1]?.alt || 'Truck build'} loading="lazy" />
        </div>
        <div class="project project3 border border-rounded rounded-lg drop-shadow shadow-md shadow-white/20 border-white/5" data-idx="2">
          <img class="smallImage" src={imgs[2]?.src} alt={imgs[2]?.alt || 'Truck build'} loading="lazy" />
        </div>
        <div class="project project4 border border-rounded rounded-lg drop-shadow shadow-md shadow-white/20 border-white/5" data-idx="3">
          <img class="smallImage" src={imgs[3]?.src} alt={imgs[3]?.alt || 'Truck build'} loading="lazy" />
        </div>
        <div class="project project5 border border-rounded rounded-lg drop-shadow shadow-md shadow-white/20 border-white/5" data-idx="4">
          <img class="smallImage" src={imgs[4]?.src} alt={imgs[4]?.alt || 'Truck build'} loading="lazy" />
        </div>
        <div class="project project6 border border-rounded rounded-lg drop-shadow shadow-md shadow-white/20 border-white/5" data-idx="5">
          <img class="smallImage" src={imgs[5]?.src} alt={imgs[5]?.alt || 'Truck build'} loading="lazy" />
        </div>
      </div>
    </div>
  </div>

  <!-- Lightbox Overlay -->
  <div class="overlay" id="galleryOverlay" aria-hidden="true">
    <div class="overlay-inner">
      <button class="close" type="button" aria-label="Close">CLOSE</button>
      <img id="overlayImage" alt="Selected build" />
    </div>
  </div>
</section>

<style>
  .gallery_1 * { font-family: Nunito, sans-serif; }
  .gallery_1 .text-blk { margin: 0; line-height: 25px; padding: 0; }
  .gallery_1 img { object-fit: contain; }
  .gallery_1 .responsive-container-block { min-height: 75px; height: fit-content; width: 100%; padding: 10px; display: flex; flex-wrap: wrap; margin: 0 auto; justify-content: flex-start; }
  .gallery_1 .responsive-container-block.bigContainer { padding: 10px 30px; }
  .gallery_1 .responsive-container-block.Container { max-width: 1320px; padding: 0; margin: 50px auto; flex-direction: column; align-items: center; justify-content: center; }
  .gallery_1 .responsive-container-block.imgContainer { padding: 0; min-height: auto; height: 720px; position: relative; }

  .gallery_1 .overlay { position: fixed; background-color: rgba(0, 0, 0, 0.7); height: 100%; width: 100%; top: 0; left: 0; z-index: 100; display: none; padding: 20px; }
  .gallery_1 .overlay-inner { position: relative; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #fff; max-width: 700px; width: 100%; padding: 35px 20px 20px; border-radius: 10px; }
  .gallery_1 .close { position: absolute; top: 9px; right: 15px; background: none; outline: 0; color: #474545; border: 0; text-transform: uppercase; letter-spacing: 2px; }
  .gallery_1 .overlay-inner img { height: auto; width: 100%; transform: none; }
  .gallery_1 .close:hover { cursor: pointer; }

  .gallery_1 .project { position: absolute; width: 39.8%; padding: 10px; }
  .gallery_1 .btn-box { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); display: none; }
  .gallery_1 .project:hover .btn-box { display: block; }
  .gallery_1 .btn { cursor: pointer; }
  .gallery_1 .smallImage {
    width: 100%;
    height: 100%;
    object-fit: contain; /* prevent cropping */
    object-position: center;
    background-color: #000000; /* letterbox fill on dark theme */
    display: block;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  }

  .gallery_1 .project.project1 { width: 39.8%; height: 66.67%; padding: 0; }
  .gallery_1 .project.project2 { bottom: 0; right: auto; width: 59.75%; height: 32.6%; padding: 0; }
  .gallery_1 .project.project3 { left: 40.2%; right: auto; bottom: auto; width: 19.4%; height: 32.98%; padding: 0; }
  .gallery_1 .project.project4 { left: 40.2%; top: 33.7%; width: 19.5%; height: 32.98%; padding: 0; }
  .gallery_1 .project.project5 { right: 0; left: auto; bottom: auto; width: 39.8%; height: 32.6%; padding: 0; }
  .gallery_1 .project.project6 { bottom: 0; left: auto; right: 0; width: 39.8%; height: 66.67%; padding: 0; }

  @media (max-width: 1024px) {
    .gallery_1 .responsive-container-block.imgContainer { height: 600px; }
  }
  @media (max-width: 768px) {
    .gallery_1 .project.project5 { top: 520px; width: 100%; left: 0; right: auto; bottom: auto; height: 200px; }
    .gallery_1 .responsive-container-block.imgContainer { height: 930px; }
    .gallery_1 .project.project1 { width: 64%; height: 300px; }
    .gallery_1 .project.project3 { left: auto; width: 35%; height: 145px; right: 0; }
    .gallery_1 .project.project4 { left: auto; width: 35%; height: 145px; top: 155px; right: 0; }
    .gallery_1 .project.project6 { height: 200px; width: 100%; }
    .gallery_1 .project.project2 { width: 100%; top: 310px; height: 200px; }
    .gallery_1 .project { width: 100%; padding: 10px 0; }
  }
  @media (max-width: 500px) {
    .gallery_1 .responsive-container-block.imgContainer { height: 890px; }
    .gallery_1 .project.project1 { height: 250px; }
    .gallery_1 .project.project3 { height: 123px; }
    .gallery_1 .project.project4 { height: 123px; top: 127px; }
    .gallery_1 .project.project2 { top: 260px; }
    .gallery_1 .project.project5 { top: 470px; }
    .gallery_1 .project.project6 { top: 680px; }
  }
</style>

<script>
  const root = document.currentScript?.closest('.gallery_1');
  const overlay = root?.querySelector('#galleryOverlay') as HTMLElement | null;
  const overlayImg = root?.querySelector('#overlayImage') as HTMLImageElement | null;
  const closeBtn = root?.querySelector('.close') as HTMLButtonElement | null;
  const projects = Array.from(root?.querySelectorAll('.project') || []);

  const imgsArr = JSON.parse(root?.getAttribute('data-images') || '[]');

  const open = (src: string, alt?: string) => {
    if (!overlay || !overlayImg) return;
    overlayImg.src = src;
    overlayImg.alt = alt || 'Truck build';
    overlay.style.display = 'block';
    overlay.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  };
  const close = () => {
    if (!overlay) return;
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  };
  closeBtn?.addEventListener('click', close);
  overlay?.addEventListener('click', (e) => { if (e.target === overlay) close(); });

  projects.forEach((p) => {
    p.addEventListener('click', () => {
      const idx = Number((p as HTMLElement).dataset.idx || '0');
      const imgEl = p.querySelector('img') as HTMLImageElement | null;
      const src = imgEl?.src || imgsArr[idx]?.src || '';
      const alt = imgEl?.alt || imgsArr[idx]?.alt || '';
      if (src) open(src, alt);
    });
  });
</script>
