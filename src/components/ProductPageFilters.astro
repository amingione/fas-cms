<div id="product-filters" class="w-full flex flex-wrap justify-center items-center gap-4 sm:gap-10 py-6 px-4 border-b border-white/10 backdrop-blur-md">
  <!-- Category Dropdown -->
  <div>
    <label for="category-select" class="block text-sm text-white mb-1">Category</label>
    <select id="category-select" class="bg-black border border-white/20 text-white px-4 py-2 rounded min-w-[180px]">
      <option value="">All Categories</option>
    </select>
  </div>

  <!-- Filter Dropdown -->
  <div>
    <label for="filter-select" class="block text-sm text-white mb-1">Filter</label>
    <select id="filter-select" class="bg-black border border-white/20 text-white px-4 py-2 rounded min-w-[180px]">
      <option value="">All Filters</option>
    </select>
  </div>

  <!-- Reset Button -->
  <div class="pt-6">
    <button id="reset-filters" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/80 transition">
      Reset Filters
    </button>
  </div>
</div>

<script>
const filterState = {
  category: '',
  productFilter: '',
};

// Fetch categories
fetch('/api/sanity/categories')
  .then(res => res.json())
  .then((categories) => {
    const select = document.getElementById('category-select');
    categories.forEach(cat => {
      const option = document.createElement('option');
      option.value = cat.slug.current;
      option.textContent = cat.title;
      select.appendChild(option);
    });
  })
  .catch(err => console.error("❌ Failed to fetch categories:", err));

// Fetch filters
fetch('/api/sanity/filters')
  .then(res => res.json())
  .then((filters) => {
    const select = document.getElementById('filter-select');
    filters.forEach(filter => {
      const option = document.createElement('option');
      option.value = filter.slug.current;
      option.textContent = filter.title;
      select.appendChild(option);
    });
  })
  .catch(err => console.error("❌ Failed to fetch filters:", err));

// Dropdown change listeners
document.getElementById('category-select')?.addEventListener('change', (e) => {
  const target = e.target as HTMLSelectElement;
  filterState.category = target.value;
  dispatchFilterChange();
});

document.getElementById('filter-select')?.addEventListener('change', (e) => {
  const target = e.target as HTMLSelectElement;
  filterState.productFilter = target.value;
  dispatchFilterChange();
});

// Reset button logic
document.getElementById('reset-filters').addEventListener('click', () => {
  filterState.category = '';
  filterState.productFilter = '';

  (document.getElementById('category-select') as HTMLSelectElement).value = '';
  (document.getElementById('filter-select') as HTMLSelectElement).value = '';

  dispatchFilterChange();
});

function dispatchFilterChange() {
  const event = new CustomEvent('filterChange', { detail: filterState });
  document.dispatchEvent(event);
}
</script>